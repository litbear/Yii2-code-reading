#WEB请求的执行流程

---------------------------
##大循环

- `yii\web\Application($config)`
- `yii\base\Application($config)::run()`

在`run()`方法内部有如下代码：

```php
try {

    $this->state = self::STATE_BEFORE_REQUEST;
    $this->trigger(self::EVENT_BEFORE_REQUEST);

    $this->state = self::STATE_HANDLING_REQUEST;
    // 获得请求句柄 为响应组织内容
    $response = $this->handleRequest($this->getRequest());

    $this->state = self::STATE_AFTER_REQUEST;
    $this->trigger(self::EVENT_AFTER_REQUEST);

    $this->state = self::STATE_SENDING_RESPONSE;
    // 发送响应
    $response->send();

    $this->state = self::STATE_END;

    return $response->exitStatus;

} catch (ExitException $e) {

    $this->end($e->statusCode, isset($response) ? $response : null);
    return $e->statusCode;

}
```
- 其中`$this->handleRequest($this->getRequest());`语句是处理请求的核心。

----------------------------------------------------------
##`yii\base\Application::handleRequest()`中的小循环：

- `yii\base\Application::handleRequest()`为抽象方法，调用子类方法
- `yii\web\Application::handleRequest()`中主要代码如下：

```php
try {
    Yii::trace("Route requested: '$route'", __METHOD__);
    $this->requestedRoute = $route;
    $result = $this->runAction($route, $params);
    if ($result instanceof Response) {
        return $result;
    } else {
        $response = $this->getResponse();
        if ($result !== null) {
            $response->data = $result;
        }

        return $response;
    }
} catch (InvalidRouteException $e) {
    throw new NotFoundHttpException(Yii::t('yii', 'Page not found.'), $e->getCode(), $e);
}
```

